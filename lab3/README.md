# Лабораторная работа №3

## Часть 1. UDP

В результате захвата получены пакеты NTP — этот протокол работает поверх UDP.

![](attachments/Pasted%20image%2020260108035239.png)

1. Рассмотрим пакет №4159. UDP-заголовок пакета содержит 4 поля: порт отправителя, порт получателя, длина и контрольная сумма.
2. Чтобы узнать длину поля, можно выделить его и посмотреть, сколько выделяется соответствующих байтов в окне с 16-чным представлением пакета. Всего заголовок занимает 8 байт:
 - Source Port: 2 байта (16 бит)
 - Destination Port: 2 байта (16 бит)
 - Length: 2 байта
 - Checksum: 2 байта
3. Length — это длина заголовка и поля данных UDP в байтах.
4. Максимальное число байт полезной нагрузки вычисляется из размера заголовка Length. $2^{16}-1=65535$ байт.
5. Максимально возможное значение номера порта источника вычисляется точно так же и равно 65525 байт.
6. Номер протокола UDP равен 17
   ![](attachments/Pasted%20image%2020260108040547.png)
7. В нашем случае для двух связанных UDP-пакетов Source Port однго является Destination Port другого и наоборот.
   ![](attachments/Pasted%20image%2020260108040810.png)

## Часть 2. TCP

### 2.1. Объемный перехват TCP-передачи данных от вашего компьютера удаленному серверу

Файл alice.txt загружен на компьютер. С запущенным захватом Wireshark произведена отправка файла на удалённый сервер по адресу gaia.cs.umass.edu/wireshark-labs/TCP-wireshark-file1.html.

Результат: удалённому серверу с нашего IP адреса отправлен POST-запрос, содержащий в качестве полезной нагрузки 116 пакетов TCP.

![](attachments/Pasted%20image%2020260108044349.png)

### 2.2. Анализ захваченной трассировки

1. Клиент, передающий файл alice.txt, использует адрес 172.30.226.180 и порт 33804.
2. У сервера gaia.cs.umass.edu адрес 128.119.245.12. Для приёма и отправки информации используется стандартный порт HTTP (80).

В меню Analyze --> Enabled Protocols сброшен флажок для HTTP. Теперь окно со списком захваченных пакетов отображает информацию о TCP-сегментах, содержащих HTTP-сообщения, а не об HTTP-сообщениях.

![](attachments/Pasted%20image%2020260108044940.png)

### 2.3. Основы протокола TCP

4. У SYN TCP-сегмента, который используется для установления TCP-соденинения между клиентом и сервером, порядковый номер — 59. О том, что этот пакет является SYN, сообщеет поле флагов, что видно на рисунке ниже.
   ![](attachments/Pasted%20image%2020260108045256.png)
5. Пакет 60 — SYNACK, использующийся для подтверждения установления соединения. Этот пакет отправляется сервером клиенту. В поле Flags видно, что Acknoledgement=1 и Syn=1.
   ![](attachments/Pasted%20image%2020260108045730.png)
6. У TCP-сегмента, содержащего команду POST протокола HTTP, порядковый номер равен 62 (см. рисунок ниже)
   ![](attachments/Pasted%20image%2020260108050008.png)
7. Использованы данные из файла захвата tcp-ethereal-trace-1.

   ![](attachments/Pasted%20image%2020260108185025.png)

   Первые 6 сегментов — пакеты под номерами 4, 5, 7, 8, 10, 11. Соответствующие им ACK-пакеты имеют номера 6, 9, 12, 14, 15, 16.

   Порядковый номер сегмента 1: `1`
   Порядковый номер сегмента 2: `566`
   Порядковый номер сегмента 3: `2026`
   Порядковый номер сегмента 4: `3486`
   Порядковый номер сегмента 5: `4946`
   Порядковый номер сегмента 6: `6406`

   RTT рассчитано по формуле: `EstimatedRTT=0,875×EstimatedRTT+0,125×SampleRTT`.

|           | Время отправки | Время получения ACK | RTT (с)  |
| --------- | -------------- | ------------------- | -------- |
| Сегмент 1 | 0.026477       | 0.053937            | 0.027460 |
| Сегмент 2 | 0.041737       | 0.077294            | 0.028472 |
| Сегмент 3 | 0.054026       | 0.124085            | 0.033670 |
| Сегмент 4 | 0.054690       | 0.169118            | 0.043765 |
| Сегмент 5 | 0.077405       | 0.217299            | 0.055781 |
| Сегмент 6 | 0.078157       | 0.267802            | 0.072514 |

8. Длина первого TCP-сегмента, содержащего команду POST протокола HTTP, равна 565 байт. Длина каждого из оставшихся пяти TCP-сегментов равна 1460 байт.
9. Минимальный объем пространства буфера, установленный сервером gaia.cs.umass.edu, во всей трассировке равен 5840 байт, которые показаны в первом подтверждении от сервера. Это окно получения увеличивается, пока максимальный размер буфера получателя не будет равен 62780 байтам. Отправитель никогда не замедится из-за блокировки пространства буфера получателя, судя по этой трассировке.
10. Трассировка не содержит повторно отправленных пакетов. Данный вывод сделан исходя из того, что последовательность номеров сегментов монотонно возрастает, что означает успешный прием всех пакетов с первого раза.
    ![](attachments/Pasted%20image%2020260108191314.png)
11. Обычно подтверждается один пакет данных (1460 байт). Но бывают ситуации, когда подтверждается сразу несколько. Пример представлен ниже (подтверждено байт больше, чем может быть в одном пакете)
    ![](attachments/Pasted%20image%2020260108192405.png)
12. Передано данных: 164091 – 1 = 164090 байтов. Общее время передач: 5,455830 – 0,026477 = 5,4294 секунд. Следовательно, пропускная способность TCP-соединения: 164090/5,4294 = 30,222 Кб/с.

### 2.4. Управление перегрузкой TCP

13. На временной шкале отправке первого пакета потока (начало медленного старта) приведено точкой около отметки 0.125 с. Около отметки 0.5 с передача текстового файла закончилась, что означает окончание ускорения передачи, т.е. окончание управления перегрузкой.
    ![](attachments/Pasted%20image%2020260108192725.png)
