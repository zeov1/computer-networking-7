# Лабораторная работа №5

## Часть 1. Ethernet

Ethernet-фрейм запроса:
![](attachments/Pasted%20image%2020260108234125.png)

1. Адрес хоста: `34:5a:60:af:ef:06`.
2. Адрес назначения: `9c:53:22:b2:e9:57`. Адрес назначения соответствует маршрутизатору — шлюзу по умолчанию.
3. Тип кадра `0x0800` - протокол IPv4.
4. Начало HTTP-заголовка GET спустя 54 байт.

Ethernet-фрейм начала ответа:
![](attachments/Pasted%20image%2020260108234219.png)

5. Адрес источника: `9c:53:22:b2:e9:57`. Адрес источника соответствует маршрутизатору - шлюзу по умолчанию.
6. Адрес назначения: `34:5a:60:af:ef:06`. Адрес назначения соответствует хосту.
7. Тип кадра `0x0800` - протокол IPv4.
8. Символ "O" из сообщения HTTP спустя 67 байт. Значение больше, чем в п. 4, т. к. символ не является первым в HTTP-пакете.

## Часть 2. ARP

9. Содержимое ARP-кэша:
   ![](attachments/Pasted%20image%2020260108234423.png)
 Столбцы:

- адрес в Интернете - IP-адрес
- Физический адрес - ассоциированный Ethernet-адрес
- Тип - тип записи
 ARP-запрос:
 ![](attachments/Pasted%20image%2020260108234600.png)
 ARP-ответ:
 ![](attachments/Pasted%20image%2020260108234700.png)

10. Исходный адрес — `00:d0:59:a9:3d:68`, конечный адрес — `ff:ff:ff:ff:ff:ff` (широковещательный).
11. Тип кадра `0x0806` - протокол ARP.
12. a. Поле опкода начинается на 21 байте; b. ARP-запрос содержит опкод 0x1; c. ARP-запрос содержит адрес отправителя, но не содержит IP-адрес получателя; d. ARP-запрос содержит поля Target IP address и Target MAC address. Одно из этих полей содержит тип запрашиваемого адреса (нули). Другое поле содержит часть с запросом IP.
13. a. Поле опкода начинается на 21 байте; b. ARP-отклик содержит опкод 0x2; c. ARP-ответ хранит запрашиваемую информацию в полях об источнике сообщения — Sender IP address и Sender MAC address.
14. Исходный адрес отклика `00:06:25:da:af:73`, адрес назначения `00:d0:59:a9:3d:68`.
15. Запрос отправляется на broadcast, поэтому воспринимается хостом, хотя адресован не ему. Ответ не адресован рассматриваемому хосту, поэтому не появляется в захвате.

## Часть 3. DHCP

Пример пакета DHCP Discover:

![](attachments/Pasted%20image%2020260108235251.png)

1. DHCP-пакеты посылаются поверх UDP, что видно на рисунке.
2. Последовательность обмена сообщений: Discover, Offer, Request, ACK
   ![](attachments/Pasted%20image%2020260108235407.png)
 Номера портов:

- Discover: 68 -> 67
- Offer: 67 -> 68
- Request: 68 -> 67
- ACK: 67 -> 68

3. У хоста Ethernet-адрес `00:08:74:4f:36:23`.
4. На тип запроса указывает поле DHCP Message Type. Для типа Discover значение Option 53: DHCP Message Type (Discover).
5. В первых 4 сообщениях Transaction ID `0x3e5e0ce3`, во втором наборе Transaction ID `0x257e55a3`. Идентификтор используется для того, чтобы DHCP-сервер мог различать различные запросы.
6. Исходно хост использует IP-адрес `0.0.0.0`, сервер использует свой адрес `192.168.1.1`. Хост отправляет запросы на DHCP-сервер с помощью broadcast адреса `255.255.255.255`. Аналогично DHCP-сервер отправляет ответы.
7. IP-адрес сервера `192.168.1.1`.
8. В сообщении DHCP Offer сервер предлагает адрес `192.168.1.101`
   ![](attachments/Pasted%20image%2020260108235714.png)
9. Relay agent IP address установлен в 0.0.0.0, что означает отсутствие ретранслирующего агента.
10. Адрес маршрутизатора указывает шлюз по умолчанию для узла. Маска подсети указывает, в какой подсети расположен узел.
11. Запрошенный IP-адрес указан в поле Option 50: Requested IP address.
    ![](attachments/Pasted%20image%2020260108235737.png)
12. Срок аренды указывает, через какой промежуток времени хост перестанет ассоциироваться с данным адресом. После этого потребуется запрашивать новый адрес или продлевать аренду данного. В данном эксперименте срок аренды 1 день (86400 с).
13. Сообщение DHCP Release сообщает серверу о том, что хост досрочно оканчивает аренду адреса и освобождает IP-адрес. На получение Release сервер ничего не отвечает. Если данное сообщение потеряется, DHCP-сервер не будет выдавать этот адрес до окончания срока аренды, т.е. адрес все еще будет считаться занятым.
14. После получения Discover сервер отправляет ARP-запрос для проверки адреса, который планируется к выдаче. В случае ответа на ARP-запрос адрес считается занятым и не будет выдан в Offer.
    ![](attachments/Pasted%20image%2020260108235808.png)
